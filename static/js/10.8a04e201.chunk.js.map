{"version":3,"sources":["../articles/_posts/使用create-react-app添加css-modules.md"],"names":["module","exports","title","tags","date","header_img","key","content"],"mappings":"4EAAAA,EAAAC,QAAA,CAAkBC,MAAA,sDAAAC,KAAA,QAAAC,KAAA,sBAAAC,WAAA,GAAAC,IAAA,yDAAAC,QAAA","file":"static/js/10.8a04e201.chunk.js","sourcesContent":["module.exports = {\"title\":\"使用create-react-app添加css-modules\",\"tags\":\"React\",\"date\":\"2018-07-30 15:30:59\",\"header_img\":\"\",\"key\":\"使用create-react-app添加css-modules.md\",\"content\":\"\\r\\n\\r\\n# 前言\\r\\n\\r\\n`create-react-app`是facebook的官方脚手架，对于个人开发者和中小型公司快速创建项目非常推荐。react的CSS解决方案有很多，这里我技术选型时用`css modules`和`sass`，然后配合antd使用通用组件库。但是create-react-app原生并不支持`css modules`和`sass`，所以需要额外配置。\\r\\n\\r\\n# 配置\\r\\n\\r\\n## 增加css modules和sass\\r\\n\\r\\n### 使用eject暴露配置\\r\\n\\r\\n`create-react-app`默认是没有暴露`webpack`配置的，所以需要eject一下。注意如果项目在git仓库环境下，先提交代码到git仓库，否则会报错\\r\\n\\r\\n```js\\r\\nnpm run eject\\r\\n```\\r\\n\\r\\n### npm添加css modules和sass\\r\\n\\r\\n```js\\r\\nnpm install react-css-modules \\r\\nnpm install sass-loader node-sass\\r\\n```\\r\\n\\r\\n这里安装sass可能会遇到墙的问题报错，所以要么使用cnpm或者使用本地代理设置，因为我有ss所以使用本地代理\\r\\n\\r\\n```js\\r\\n// 开启代理\\r\\nnpm config set proxy http://127.0.0.1:1080\\r\\n// 安装完sass后关闭代理\\r\\nnpm config delete proxy\\r\\n```\\r\\n\\r\\n### webpack配置\\r\\n\\r\\n重点来了，我们需要给`webpack`配置上`css-modules`和`sass-loader`。但是使用`css-modules`会使`node_modules`库里的css样式找不到，比如后面要使用到的antd，这个时候我们需要inclube来排除影响`node_modules`，使得`css-modules`不会影响到`node_modules`\\r\\n\\r\\n修改项目中`config`目录下的`webpack.config.dev.js`和`webpack.config.prod.js`，说明下这两个文件，前一个是开发环境`npm start`使用，后一个是`npm run build`打包后使用\\r\\n\\r\\n- 修改`webpack.config.dev.js`:\\r\\n\\r\\n大约在160行左右，找到`test: /\\\\.css$/`，中文注释的地方就是修改和增加的地方\\r\\n\\r\\n```js\\r\\n          {\\r\\n            test: [/\\\\.css$/, /\\\\.scss$/],// 这里增加SCSS的支持\\r\\n            exclude: [/node_modules/],// 这里去排除node_modules，防止css modules影响到node_modules\\r\\n            use: [\\r\\n              require.resolve('style-loader'),\\r\\n              {\\r\\n                loader: require.resolve('css-loader'),\\r\\n                options: {\\r\\n                  importLoaders: 1,\\r\\n                  modules: true, // 这里增加对css modules的支持\\r\\n                  localIdentName: '[name]__[local]__[hash:base64:5]' //这里增加对css modules的支持\\r\\n                },\\r\\n              },\\r\\n              {\\r\\n                loader: require.resolve('sass-loader'), // 这里增加sass的支持\\r\\n              },\\r\\n              {\\r\\n                loader: require.resolve('postcss-loader'),\\r\\n                options: {\\r\\n                  // Necessary for external CSS imports to work\\r\\n                  // https://github.com/facebookincubator/create-react-app/issues/2677\\r\\n                  ident: 'postcss',\\r\\n                  plugins: () => [\\r\\n                    require('postcss-flexbugs-fixes'),\\r\\n                    autoprefixer({\\r\\n                      browsers: [\\r\\n                        '>1%',\\r\\n                        'last 4 versions',\\r\\n                        'Firefox ESR',\\r\\n                        'not ie < 9', // React doesn't support IE8 anyway\\r\\n                      ],\\r\\n                      flexbox: 'no-2009',\\r\\n                    }),\\r\\n                  ],\\r\\n                },\\r\\n              },\\r\\n            ],\\r\\n          },\\r\\n          // 因为上面排除了css_modules所以这里一定要再添加个排除src来识别css_modules\\r\\n          // 其实就是复制之前没修改前的所有，再增加一个exclude: [/src/]\\r\\n          {\\r\\n            test: /\\\\.css$/, \\r\\n            exclude: [/src/], // 这里添加排除src，\\r\\n            use: [\\r\\n              require.resolve('style-loader'),\\r\\n              {\\r\\n                loader: require.resolve('css-loader'),\\r\\n                options: {\\r\\n                  importLoaders: 1,\\r\\n                },\\r\\n              },\\r\\n              {\\r\\n                loader: require.resolve('postcss-loader'),\\r\\n                options: {\\r\\n                  // Necessary for external CSS imports to work\\r\\n                  // https://github.com/facebookincubator/create-react-app/issues/2677\\r\\n                  ident: 'postcss',\\r\\n                  plugins: () => [\\r\\n                    require('postcss-flexbugs-fixes'),\\r\\n                    autoprefixer({\\r\\n                      browsers: [\\r\\n                        '>1%',\\r\\n                        'last 4 versions',\\r\\n                        'Firefox ESR',\\r\\n                        'not ie < 9', // React doesn't support IE8 anyway\\r\\n                      ],\\r\\n                      flexbox: 'no-2009',\\r\\n                    }),\\r\\n                  ],\\r\\n                },\\r\\n              },\\r\\n            ],\\r\\n          }\\r\\n```\\r\\n\\r\\n- 修改`webpack.config.prod.js`:\\r\\n\\r\\n和上面修改`webpack.config.dev.js`类似\\r\\n\\r\\n```js\\r\\n        {\\r\\n            test: [/\\\\.css$/, /\\\\.scss$/], // 这里增加SCSS的支持\\r\\n            exclude: [/node_modules/], // 这里去排除node_modules\\r\\n            loader: ExtractTextPlugin.extract(\\r\\n              Object.assign(\\r\\n                {\\r\\n                  fallback: {\\r\\n                    loader: require.resolve('style-loader'),\\r\\n                    options: {\\r\\n                      hmr: false,\\r\\n                    },\\r\\n                  },\\r\\n                  use: [\\r\\n                    {\\r\\n                      loader: require.resolve('css-loader'),\\r\\n                      options: {\\r\\n                        importLoaders: 1,\\r\\n                        minimize: true,\\r\\n                        sourceMap: true,\\r\\n                        modules: true, // 这里添加css modules支持\\r\\n                      },\\r\\n                    },\\r\\n                    {\\r\\n                      loader: require.resolve('postcss-loader'),\\r\\n                      options: {\\r\\n                        // Necessary for external CSS imports to work\\r\\n                        // https://github.com/facebookincubator/create-react-app/issues/2677\\r\\n                        ident: 'postcss',\\r\\n                        plugins: () => [\\r\\n                          require('postcss-flexbugs-fixes'),\\r\\n                          autoprefixer({\\r\\n                            browsers: [\\r\\n                              '>1%',\\r\\n                              'last 4 versions',\\r\\n                              'Firefox ESR',\\r\\n                              'not ie < 9', // React doesn't support IE8 anyway\\r\\n                            ],\\r\\n                            flexbox: 'no-2009',\\r\\n                          }),\\r\\n                        ],\\r\\n                      },\\r\\n                    },\\r\\n                    {\\r\\n                      loader: require.resolve('sass-loader'), // 这里添加sass支持\\r\\n                    }\\r\\n                  ],\\r\\n                },\\r\\n\\r\\n                extractTextPluginOptions\\r\\n              )\\r\\n            ),\\r\\n            // Note: this won't work without `new ExtractTextPlugin()` in `plugins`.\\r\\n          },\\r\\n          {\\r\\n            test: /\\\\.css$/,\\r\\n            exclude: [/src/], // 排除src\\r\\n            loader: ExtractTextPlugin.extract(\\r\\n              Object.assign(\\r\\n                {\\r\\n                  fallback: {\\r\\n                    loader: require.resolve('style-loader'),\\r\\n                    options: {\\r\\n                      hmr: false,\\r\\n                    },\\r\\n                  },\\r\\n                  use: [\\r\\n                    {\\r\\n                      loader: require.resolve('css-loader'),\\r\\n                      options: {\\r\\n                        importLoaders: 1,\\r\\n                        minimize: true,\\r\\n                        sourceMap: true,\\r\\n                      },\\r\\n                    },\\r\\n                    {\\r\\n                      loader: require.resolve('postcss-loader'),\\r\\n                      options: {\\r\\n                        // Necessary for external CSS imports to work\\r\\n                        // https://github.com/facebookincubator/create-react-app/issues/2677\\r\\n                        ident: 'postcss',\\r\\n                        plugins: () => [\\r\\n                          require('postcss-flexbugs-fixes'),\\r\\n                          autoprefixer({\\r\\n                            browsers: [\\r\\n                              '>1%',\\r\\n                              'last 4 versions',\\r\\n                              'Firefox ESR',\\r\\n                              'not ie < 9', // React doesn't support IE8 anyway\\r\\n                            ],\\r\\n                            flexbox: 'no-2009',\\r\\n                          }),\\r\\n                        ],\\r\\n                      },\\r\\n                    }\\r\\n                  ],\\r\\n                },\\r\\n\\r\\n                extractTextPluginOptions\\r\\n              )\\r\\n            ),\\r\\n            // Note: this won't work without `new ExtractTextPlugin()` in `plugins`.\\r\\n          }\\r\\n```\\r\\n\\r\\n### 安装antd和配置\\r\\n\\r\\n主要是安装配置`antd`和`babel-plugin-import`，这样可以使得`antd`按需加载样式\\r\\n\\r\\n#### npm添加antd和babel-plugin-import\\r\\n\\r\\n```js\\r\\nnpm install antd\\r\\nnpm install babel-plugin-import\\r\\n```\\r\\n\\r\\n#### 配置babel\\r\\n\\r\\n在项目根目录下增加`.babelrc`文件，然后配置如下\\r\\n\\r\\n```js\\r\\n{\\r\\n  \\\"presets\\\": [\\r\\n    \\\"react-app\\\"\\r\\n  ],\\r\\n  \\\"plugins\\\": [\\r\\n    \\\"transform-runtime\\\",\\r\\n    [\\r\\n      \\\"import\\\",\\r\\n      {\\r\\n        \\\"libraryName\\\": \\\"antd\\\",\\r\\n        \\\"style\\\": \\\"css\\\"\\r\\n      }\\r\\n    ]\\r\\n  ]\\r\\n}\\r\\n```\\r\\n\\r\\n大功告成\\r\\n\"}"],"sourceRoot":""}