{"version":3,"sources":["../articles/_posts/使用create-react-app添加css-modules.md"],"names":["module","exports","title","tags","date","header_img","key","content"],"mappings":"4EAAAA,EAAAC,QAAA,CAAkBC,MAAA,sDAAAC,KAAA,QAAAC,KAAA,sBAAAC,WAAA,GAAAC,IAAA,yDAAAC,QAAA","file":"static/js/16.17be9212.chunk.js","sourcesContent":["module.exports = {\"title\":\"使用create-react-app添加css-modules\",\"tags\":\"React\",\"date\":\"2018-07-30 15:30:59\",\"header_img\":\"\",\"key\":\"使用create-react-app添加css-modules.md\",\"content\":\"\\n\\n# 前言\\n\\n`create-react-app`是facebook的官方脚手架，对于个人开发者和中小型公司快速创建项目非常推荐。react的CSS解决方案有很多，这里我技术选型时用`css modules`和`sass`，然后配合antd使用通用组件库。但是create-react-app原生并不支持`css modules`和`sass`，所以需要额外配置。\\n\\n# 配置\\n\\n## 增加css modules和sass\\n\\n### 使用eject暴露配置\\n\\n`create-react-app`默认是没有暴露`webpack`配置的，所以需要eject一下。注意如果项目在git仓库环境下，先提交代码到git仓库，否则会报错\\n\\n```js\\nnpm run eject\\n```\\n\\n### npm添加css modules和sass\\n\\n```js\\nnpm install react-css-modules \\nnpm install sass-loader node-sass\\n```\\n\\n这里安装sass可能会遇到墙的问题报错，所以要么使用cnpm或者使用本地代理设置，因为我有ss所以使用本地代理\\n\\n```js\\n// 开启代理\\nnpm config set proxy http://127.0.0.1:1080\\n// 安装完sass后关闭代理\\nnpm config delete proxy\\n```\\n\\n### webpack配置\\n\\n重点来了，我们需要给`webpack`配置上`css-modules`和`sass-loader`。但是使用`css-modules`会使`node_modules`库里的css样式找不到，比如后面要使用到的antd，这个时候我们需要inclube来排除影响`node_modules`，使得`css-modules`不会影响到`node_modules`\\n\\n修改项目中`config`目录下的`webpack.config.dev.js`和`webpack.config.prod.js`，说明下这两个文件，前一个是开发环境`npm start`使用，后一个是`npm run build`打包后使用\\n\\n- 修改`webpack.config.dev.js`:\\n\\n大约在160行左右，找到`test: /\\\\.css$/`，中文注释的地方就是修改和增加的地方\\n\\n```js\\n          {\\n            test: [/\\\\.css$/, /\\\\.scss$/],// 这里增加SCSS的支持\\n            exclude: [/node_modules/],// 这里去排除node_modules，防止css modules影响到node_modules\\n            use: [\\n              require.resolve('style-loader'),\\n              {\\n                loader: require.resolve('css-loader'),\\n                options: {\\n                  importLoaders: 1,\\n                  modules: true, // 这里增加对css modules的支持\\n                  localIdentName: '[name]__[local]__[hash:base64:5]' //这里增加对css modules的支持\\n                },\\n              },\\n              {\\n                loader: require.resolve('sass-loader'), // 这里增加sass的支持\\n              },\\n              {\\n                loader: require.resolve('postcss-loader'),\\n                options: {\\n                  // Necessary for external CSS imports to work\\n                  // https://github.com/facebookincubator/create-react-app/issues/2677\\n                  ident: 'postcss',\\n                  plugins: () => [\\n                    require('postcss-flexbugs-fixes'),\\n                    autoprefixer({\\n                      browsers: [\\n                        '>1%',\\n                        'last 4 versions',\\n                        'Firefox ESR',\\n                        'not ie < 9', // React doesn't support IE8 anyway\\n                      ],\\n                      flexbox: 'no-2009',\\n                    }),\\n                  ],\\n                },\\n              },\\n            ],\\n          },\\n          // 因为上面排除了css_modules所以这里一定要再添加个排除src来识别css_modules\\n          // 其实就是复制之前没修改前的所有，再增加一个exclude: [/src/]\\n          {\\n            test: /\\\\.css$/, \\n            exclude: [/src/], // 这里添加排除src，\\n            use: [\\n              require.resolve('style-loader'),\\n              {\\n                loader: require.resolve('css-loader'),\\n                options: {\\n                  importLoaders: 1,\\n                },\\n              },\\n              {\\n                loader: require.resolve('postcss-loader'),\\n                options: {\\n                  // Necessary for external CSS imports to work\\n                  // https://github.com/facebookincubator/create-react-app/issues/2677\\n                  ident: 'postcss',\\n                  plugins: () => [\\n                    require('postcss-flexbugs-fixes'),\\n                    autoprefixer({\\n                      browsers: [\\n                        '>1%',\\n                        'last 4 versions',\\n                        'Firefox ESR',\\n                        'not ie < 9', // React doesn't support IE8 anyway\\n                      ],\\n                      flexbox: 'no-2009',\\n                    }),\\n                  ],\\n                },\\n              },\\n            ],\\n          }\\n```\\n\\n- 修改`webpack.config.prod.js`:\\n\\n和上面修改`webpack.config.dev.js`类似\\n\\n```js\\n        {\\n            test: [/\\\\.css$/, /\\\\.scss$/], // 这里增加SCSS的支持\\n            exclude: [/node_modules/], // 这里去排除node_modules\\n            loader: ExtractTextPlugin.extract(\\n              Object.assign(\\n                {\\n                  fallback: {\\n                    loader: require.resolve('style-loader'),\\n                    options: {\\n                      hmr: false,\\n                    },\\n                  },\\n                  use: [\\n                    {\\n                      loader: require.resolve('css-loader'),\\n                      options: {\\n                        importLoaders: 1,\\n                        minimize: true,\\n                        sourceMap: true,\\n                        modules: true, // 这里添加css modules支持\\n                      },\\n                    },\\n                    {\\n                      loader: require.resolve('postcss-loader'),\\n                      options: {\\n                        // Necessary for external CSS imports to work\\n                        // https://github.com/facebookincubator/create-react-app/issues/2677\\n                        ident: 'postcss',\\n                        plugins: () => [\\n                          require('postcss-flexbugs-fixes'),\\n                          autoprefixer({\\n                            browsers: [\\n                              '>1%',\\n                              'last 4 versions',\\n                              'Firefox ESR',\\n                              'not ie < 9', // React doesn't support IE8 anyway\\n                            ],\\n                            flexbox: 'no-2009',\\n                          }),\\n                        ],\\n                      },\\n                    },\\n                    {\\n                      loader: require.resolve('sass-loader'), // 这里添加sass支持\\n                    }\\n                  ],\\n                },\\n\\n                extractTextPluginOptions\\n              )\\n            ),\\n            // Note: this won't work without `new ExtractTextPlugin()` in `plugins`.\\n          },\\n          {\\n            test: /\\\\.css$/,\\n            exclude: [/src/], // 排除src\\n            loader: ExtractTextPlugin.extract(\\n              Object.assign(\\n                {\\n                  fallback: {\\n                    loader: require.resolve('style-loader'),\\n                    options: {\\n                      hmr: false,\\n                    },\\n                  },\\n                  use: [\\n                    {\\n                      loader: require.resolve('css-loader'),\\n                      options: {\\n                        importLoaders: 1,\\n                        minimize: true,\\n                        sourceMap: true,\\n                      },\\n                    },\\n                    {\\n                      loader: require.resolve('postcss-loader'),\\n                      options: {\\n                        // Necessary for external CSS imports to work\\n                        // https://github.com/facebookincubator/create-react-app/issues/2677\\n                        ident: 'postcss',\\n                        plugins: () => [\\n                          require('postcss-flexbugs-fixes'),\\n                          autoprefixer({\\n                            browsers: [\\n                              '>1%',\\n                              'last 4 versions',\\n                              'Firefox ESR',\\n                              'not ie < 9', // React doesn't support IE8 anyway\\n                            ],\\n                            flexbox: 'no-2009',\\n                          }),\\n                        ],\\n                      },\\n                    }\\n                  ],\\n                },\\n\\n                extractTextPluginOptions\\n              )\\n            ),\\n            // Note: this won't work without `new ExtractTextPlugin()` in `plugins`.\\n          }\\n```\\n\\n### 安装antd和配置\\n\\n主要是安装配置`antd`和`babel-plugin-import`，这样可以使得`antd`按需加载样式\\n\\n#### npm添加antd和babel-plugin-import\\n\\n```js\\nnpm install antd\\nnpm install babel-plugin-import\\n```\\n\\n#### 配置babel\\n\\n在项目根目录下增加`.babelrc`文件，然后配置如下\\n\\n```js\\n{\\n  \\\"presets\\\": [\\n    \\\"react-app\\\"\\n  ],\\n  \\\"plugins\\\": [\\n    \\\"transform-runtime\\\",\\n    [\\n      \\\"import\\\",\\n      {\\n        \\\"libraryName\\\": \\\"antd\\\",\\n        \\\"style\\\": \\\"css\\\"\\n      }\\n    ]\\n  ]\\n}\\n```\\n\\n大功告成\\n\"}"],"sourceRoot":""}